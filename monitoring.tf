resource "aws_cloudwatch_log_group" "eks_cluster_log_group" { name = var.cloudwatch_log_group_name retention_in_days = 30 tags = { Name = "EKS-Cluster-Log-Group-${var.environment}" } } resource "aws_cloudwatch_log_metric_filter" "eks_cluster_api_errors" { name = "eks-cluster-api-errors" log_group_name = aws_cloudwatch_log_group.eks_cluster_log_group.name filter_pattern = "{$.request.method} = "POST" and {$.request.status} >= 400" metric_namespace = "EKS-Cluster-API-Errors" metric_name = "ApiErrors" } resource "aws_s3_bucket" "cloudtrail_bucket" { bucket = var.cloudtrail_bucket_name tags = { Name = "EKS-Cluster-CloudTrail-Bucket-${var.environment}" } } resource "aws_s3_bucket_acl" "cloudtrail_bucket_acl" { bucket = aws_s3_bucket.cloudtrail_bucket.bucket acl = "private" } resource "aws_s3_bucket_versioning" "cloudtrail_bucket_versioning" { bucket = aws_s3_bucket.cloudtrail_bucket.bucket enabled = true } resource "aws_s3_bucket_server_side_encryption_configuration" "cloudtrail_bucket_encryption" { bucket = aws_s3_bucket.cloudtrail_bucket.bucket rule { apply_server_side_encryption_by_default { sse_algorithm = "AES256" } } } resource "aws_cloudtrail" "eks_cluster_cloudtrail" { name = "eks-cluster-cloudtrail" is_multi_region_trail = false trail_name_prefix = "eks-cluster-trail" s3_bucket_name = aws_s3_bucket.cloudtrail_bucket.bucket s3_key_prefix = "cloudtrail-logs" enable_logging = true include_global_service_events = true event_selectors { read_write_type = "all" } }